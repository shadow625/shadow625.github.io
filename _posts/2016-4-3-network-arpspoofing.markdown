---
layout: post
title:  network-arp欺骗
subtitle: "network security"
author: "Shadow"
avatar: "image/IMG_2916.jpg"
thumbnail: fa-anchor
date:   2016-4-3 12:12:12
---


如果你有个路由器，你能做什么。
     家用路由器现在几乎是每个人家中必不可少的一个设备，也是让智能手机用户非常感动的一个设备（流量不用钱了），但是在享受这些网络设备带给我们便捷的同时，网路安全也同时在影响着你，`处在互联网合适位置的人，能够产生巨大的影响力`，这是一个非常严肃的话题。（好吧，扯远了）
     今天希望介绍一下ARP 欺骗使得抓取路由器所承载用户的数据包（Android分析用到的，在这里整理一下，分享出来）
     首先我们需要来介绍一下ARP协议，
          > 全名为address resolution protocol
          是用于进行地址解析，在一个交换网络中，希望通过局域网交换机发送数据给另一个终端，我们需要该终端的物理地址以及逻辑地址，但是加入现在你只知道IP地址而没有Mac地址，怎么办。我们是不是可以设想两种解决方法，
          
1.在每个网络设备中存一张表，每个局域网中的IP Mac 都记录下来，然后不再变化。到时候想发给谁直接查找表，然后寻找，发送。done····结果 这中间存在问题，IP地址属于一个设备在互联网中的一个逻辑地址，而Mac 地址（物理地址）他是固化在网卡上的，所以 可想而知，这个IP Mac 组合是一个会变化的事件，一旦加入新的网络设备，或者某个网络设备离开，然后回来，都会使得这个表无能为力。所以，前人使用了一个动态的方法做这个事情。

2.每个设备都维护着一张表，记录了IP Mac组合，感觉是不是和上一个差不多，区别在后面，这是个可以变化的表，每当需要向某个设备发送信息时（包括路由器，后面会介绍相关的安全问题）会寻找这个表格，而当表中没有该元素时，这个时候他就会急了，他需要知道这个IP地址所对应的物理地址是多少啊，不然他没法发送啊，所以他就大声喊叫（发送广播消息）询问该局域网中谁具有该IP地址，所有人都会收到这个消息，然后和自己的IP比对，发现是在问自己，他就会在发送一个回信给那个发送设备，并附上自己的IP地址和Mac地址，就是告诉他 你发到这里来吧。否则丢弃该消息。然后设备会在一定时间后刷新一次这个表，即就是更新一次表的内容。 以上就是描述了一个ARP协议工作流程，翻译为术语则是 A设备希望给B设备发送消息，但是只有B的IP地址，则A会寻找自己的ARP表中B的信息，如果没有就会通过ARP协议获得，并填入ARP表，首先A发送一个ARP广播（通过路由器），向局域网内所有设备询问谁具有该IP地址，每个人收到该消息后，会检查自己的IP和消息中需要的IP是否一致， 如果不一致则丢弃。假如B收到，发现是询问自己的IP的，那么他就会向A发送一个ARP回复消息，这条消息以单播形式发送，告诉A自己的IP地址和Mac地址，然后结束。

3.然而当时网络协议的设计都认为每个人都是善良纯洁的，都是无害的上网（大量事实表明······），导致该协议极不安全，·处于网络合适位置的恶意上网者，能够产生很恶劣的后果。·如果一个恶意的第三方C，收到了不是指向自己的ARP消息（因为是广播，所有交换域内的人都会收到）没有丢弃而是解读然后发送回信，告诉A 你想要B的Mac地址是吧，他的地址是（C的Mac）则就会产生消息误发。假如C收到了以后帮你转发给B（可能叫包内容改写）则会引发中间人攻击，假如不转发，则称为消息劫持。（同称ARP欺骗）

我们现在希望抓到Android的数据包，那么可以通过这种方法欺骗Android设备，将我们的设备作为网关，消息通过我们转发给网关。则就可以抓去Android的数据了。
